# üß≠ **Features & Architecture Overview**

**Project:** Desmond Liew ‚Äî Cross-Platform Portfolio
**Tech:** Flutter (Web, Android, Windows, Linux)
**Hosting:** GitHub Pages (web) + GitHub Releases (binaries)
**Data Source:** Markdown (with front-matter + optional encryption)
**Goal:** No-cost, Markdown-driven portfolio and knowledge system that auto-updates when new `.md` files are added.

---

## ‚öôÔ∏è Core Principles

1. **Single repo** ‚Üí all platforms share one codebase.
2. **Markdown-first** ‚Üí all content (pages, posts, projects, etc.) written as `.md` files.
3. **Auto-discovery** ‚Üí new Markdown automatically appears; no code edits.
4. **Client-side encryption** ‚Üí private pages stored as ciphertext; decrypted only in the app.
5. **GitHub-only stack** ‚Üí Pages for hosting, Releases for binaries, Actions for CI/CD.
6. **Zero paid services** ‚Üí everything local or open-source.
7. **Consistency** ‚Üí all Dart code inside `/lib`.

---

## üß© Folder Architecture (Full Explanation)

### Root (`/`)

| Item                                                       | Purpose                                                     |
| ---------------------------------------------------------- | ----------------------------------------------------------- |
| `.github/`                                                 | GitHub automation and templates.                            |
| `.vscode/`                                                 | Editor recommendations and formatting rules.                |
| `android/`, `ios/`, `linux/`, `macos/`, `windows/`, `web/` | Platform scaffolds (auto-generated by Flutter).             |
| `assets/`                                                  | Stores Markdown content, media, and the generated manifest. |
| `lib/`                                                     | Entire app source (UI, logic, crypto, tools).               |
| `pubspec.yaml`                                             | Flutter dependencies and assets registration.               |
| `analysis_options.yaml`                                    | Code linting and style rules.                               |
| `README.md`, `LICENSE`, `.gitignore`, `.editorconfig`      | Repository metadata.                                        |

---

## üóÇÔ∏è **`.github/` ‚Äî Automation & CI/CD**

| Path                                 | Description                                                                                                                       |
| ------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------- |
| `.github/workflows/deploy_pages.yml` | Builds Flutter web ‚Üí pushes `/build/web` to `gh-pages` for GitHub Pages hosting. Runs `build_manifest`, `gen_sitemap`, `gen_rss`. |
| `.github/workflows/releases.yml`     | Builds platform binaries (Android, Windows, Linux) on tag ‚Üí uploads to GitHub Releases.                                           |
| `.github/ISSUE_TEMPLATE/`            | Templates for bugs and features (optional).                                                                                       |

---

## üß± **`assets/` ‚Äî Content Root**

All your Markdown lives here. You never hard-code it.

```
assets/
‚îî‚îÄ contents/
   ‚îú‚îÄ pages/
   ‚îú‚îÄ projects/
   ‚îú‚îÄ blog/
   ‚îú‚îÄ labs/
   ‚îú‚îÄ library/
   ‚îú‚îÄ meta/
   ‚îú‚îÄ foundation/
   ‚îú‚îÄ _media/
   ‚îî‚îÄ manifest.json
```

| Folder          | Purpose                                     |
| --------------- | ------------------------------------------- |
| `pages/`        | Static pages (Home, About, Services, etc.). |
| `projects/`     | Portfolio case studies (`type: project`).   |
| `blog/`         | Writing, logs, essays (`type: post`).       |
| `labs/`         | Experiments, prototypes (`type: lab`).      |
| `library/`      | Reading lists, resources, references.       |
| `meta/`         | Personality, philosophy, system design.     |
| `foundation/`   | Legal, privacy, site system docs.           |
| `_media/`       | Images used in Markdown.                    |
| `manifest.json` | Auto-generated index of all Markdown files. |

**Each `.md` has YAML front-matter:**

```yaml
---
title: "Judicial V2T Backend"
slug: "judicial-v2t"
type: "project"
realm: "outer"
visibility: "private"
date: "2025-10-01"
updated: "2025-10-28"
tags: ["whisper", "fastapi", "docker"]
summary: "On-prem ASR backend with Whisper + FastAPI + Docker."
thumbnail: "/assets/contents/_media/judicial-thumb.png"
---
```

If `visibility: private`, the plaintext body is replaced by a fenced `:::cipher` block after encryption.

---

## üß† **`lib/` ‚Äî The Application**

### `lib/app/` ‚Äî App Shell & Configuration

| File          | Description                                                      |
| ------------- | ---------------------------------------------------------------- |
| `main.dart`   | Entry point; initializes providers, router, and theme.           |
| `router.dart` | All route definitions via `go_router`; uses dynamic slug routes. |
| `theme.dart`  | Color tokens (Metal/Earth palette), typography, dark/light mode. |
| `di.dart`     | Simple dependency injection container.                           |
| `config.dart` | Global constants (base URL, content path, visibility rules).     |

---

### `lib/core/` ‚Äî Universal Core Layer

Contains all **non-UI logic** and reusable backend-style code.

| File                   | Role                                                                   |
| ---------------------- | ---------------------------------------------------------------------- |
| `models.dart`          | Defines core data types: `FrontMatter`, `ContentNode`, `CipherBlock`.  |
| `front_matter.dart`    | Parses `---` YAML block from Markdown.                                 |
| `markdown_loader.dart` | Loads Markdown (from assets or network), splits FM/body.               |
| `cipher_block.dart`    | Detects & parses `:::cipher` fenced blocks.                            |
| `crypto.dart`          | Handles Argon2id key derivation and AES-256-GCM encryption/decryption. |
| `manifest.dart`        | Reads and filters `assets/contents/manifest.json`.                     |
| `search_index.dart`    | Builds in-memory search from manifest + unlocked private items.        |
| `seo.dart`             | Injects `<title>` and meta tags for Flutter Web.                       |
| `a11y.dart`            | Accessibility utilities (focus rings, reduced motion, contrast).       |
| `utils.dart`           | Misc. helpers (slugify, date parsing, string utils).                   |

---

### `lib/features/` ‚Äî UI Features (each top-level section)

Each folder mirrors a major site section (as defined in the sitemap).
All are built with Flutter widgets using `flutter_markdown_plus` for Markdown rendering.

#### üåû **Public Realm**

| Folder        | Key Files                                                                     | Purpose                              |
| ------------- | ----------------------------------------------------------------------------- | ------------------------------------ |
| `home/`       | `home_page.dart`                                                              | Landing page.                        |
| `about/`      | `about_page.dart`                                                             | Biography, philosophy, timeline.     |
| `projects/`   | `projects_index_page.dart`, `project_detail_page.dart`, `project_badges.dart` | Portfolio list and case studies.     |
| `blog/`       | `blog_index_page.dart`, `blog_post_page.dart`, `blog_series_page.dart`        | Blog index, posts, and series pages. |
| `services/`   | `services_page.dart`                                                          | Consulting offers and process.       |
| `labs/`       | `labs_page.dart`                                                              | Experimental tools, prototypes.      |
| `library/`    | `library_page.dart`                                                           | Resources and reading lists.         |
| `contact/`    | `contact_page.dart`                                                           | Contact form and info.               |
| `resume/`     | `resume_page.dart`                                                            | Web r√©sum√© with PDF download.        |
| `newsletter/` | `subscribe_page.dart`, `archive_page.dart`                                    | Newsletter subscription and archive. |

#### üåô **Inner Realm (Private/Login)**

| Folder                                                           | Description                                                       |
| ---------------------------------------------------------------- | ----------------------------------------------------------------- |
| `inner/`                                                         | Private dashboard, case studies, journals, and decryption system. |
| ‚Ä¢ `inner_dashboard_page.dart` ‚Äî main hub after login.            |                                                                   |
| ‚Ä¢ `lock_gate.dart` ‚Äî passphrase prompt and validation.           |                                                                   |
| ‚Ä¢ `unlock_controller.dart` ‚Äî manages key state (in memory only). |                                                                   |
| ‚Ä¢ `inner_case_studies_page.dart` ‚Äî NDA projects (private).       |                                                                   |
| ‚Ä¢ `inner_research_page.dart` ‚Äî architecture docs & ADRs.         |                                                                   |
| ‚Ä¢ `inner_resources_page.dart` ‚Äî templates, prompt libs.          |                                                                   |
| ‚Ä¢ `inner_journals_page.dart` ‚Äî personal learning logs.           |                                                                   |
| ‚Ä¢ `inner_metaphysics_page.dart` ‚Äî private metaphysical notes.    |                                                                   |
| ‚Ä¢ `inner_clients_page.dart` ‚Äî client-specific proposals.         |                                                                   |

#### üúÇ **Meta Realm**

| Folder  | Pages                                                                              |
| ------- | ---------------------------------------------------------------------------------- |
| `meta/` | Personality, tarot, numerology, bazi, tcm, philosophy, systems, justice-manifesto. |

#### üúÉ **Foundation Realm**

| Folder        | Pages                                                                                                                                                                            |
| ------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `foundation/` | Legal and system pages ‚Äî `search_page.dart`, `sitemap_page.dart`, `privacy_page.dart`, `terms_page.dart`, `cookies_page.dart`, `accessibility_page.dart`, `changelog_page.dart`. |

#### ü™ê **Supporting**

| Folder      | Pages                                        |
| ----------- | -------------------------------------------- |
| `timeline/` | Visual interactive career/life timeline.     |
| `shell/`    | Global app shell, navigation bars, 404 page. |

---

### `lib/widgets/` ‚Äî Shared Components

| File                  | Purpose                                                                   |
| --------------------- | ------------------------------------------------------------------------- |
| `md_view.dart`        | Markdown renderer wrapping `flutter_markdown_plus` (with custom styling). |
| `md_image.dart`       | Resolves relative image paths (`/assets/contents/_media/`).               |
| `callout.dart`        | For info/warning/ethics callouts in Markdown.                             |
| `toc.dart`            | Generates table of contents from Markdown headings.                       |
| `chips.dart`          | Tag or series chips.                                                      |
| `search_box.dart`     | Universal search widget.                                                  |
| `section_header.dart` | Stylized section headers.                                                 |
| `metrics_strip.dart`  | Displays project metrics (p95, latency, etc.).                            |
| `lock_banner.dart`    | Shows "Private mode active ‚Ä¢ Lock again".                                 |

---

### `lib/tools/` ‚Äî Command-Line Utilities (run manually or in CI)

| Tool                    | Description                                                                                                           |
| ----------------------- | --------------------------------------------------------------------------------------------------------------------- |
| `encrypt_markdown.dart` | Encrypts Markdown body when `visibility: private`. Replaces body with `:::cipher` block using AES-256-GCM + Argon2id. |
| `build_manifest.dart`   | Scans `/assets/contents/**.md`, extracts front-matter, builds `manifest.json`.                                        |
| `gen_sitemap.dart`      | Creates `sitemap.xml` for all public URLs.                                                                            |
| `gen_rss.dart`          | Generates RSS feed for public blog posts.                                                                             |

Run any tool with:

```
dart run lib/tools/<tool>.dart
```

---

## üß† Data Model Summary

| Entity          | Key Fields                                                                                                  | Description                                |
| --------------- | ----------------------------------------------------------------------------------------------------------- | ------------------------------------------ |
| **FrontMatter** | `title`, `slug`, `type`, `realm`, `visibility`, `date`, `updated`, `tags`, `summary`, `thumbnail`, `series` | Parsed YAML header for each Markdown file. |
| **ContentNode** | Combines `FrontMatter` + file path; used in manifest and listings.                                          |                                            |
| **CipherBlock** | Holds salt, nonce, and base64 ciphertext for private bodies.                                                |                                            |
| **Manifest**    | JSON array of all ContentNodes (public & private).                                                          |                                            |
| **SearchIndex** | Maps keywords ‚Üí ContentNodes (only loaded ones).                                                            |                                            |

---

## üîê Private Content Workflow

1. Write Markdown with `visibility: private`.
2. Run `dart run lib/tools/encrypt_markdown.dart`.
3. Script derives key (Argon2id) and encrypts body (AES-GCM).
4. Replaces plaintext with `:::cipher` block.
5. Commit ciphertext safely ‚Äî it‚Äôs unreadable.
6. At runtime, app prompts for passphrase, derives same key, decrypts in memory.

---

## üîÑ Content Auto-Discovery Logic

1. CI (or manual run) executes `build_manifest.dart`.
2. Manifest lists all items by `type`.
3. Flutter app loads manifest at startup.
4. Each index page filters by `type` and `visibility`.
5. Dynamic routes (`/projects/:slug`, `/blog/:slug`, etc.) match automatically.
6. New `.md` = new entry = instantly visible after next deploy.

---

## üßÆ CI/CD Pipeline (Zero-Cost)

| Stage                         | Description                                                                                  |
| ----------------------------- | -------------------------------------------------------------------------------------------- |
| **1. Build Manifest & Feeds** | `build_manifest.dart`, `gen_sitemap.dart`, `gen_rss.dart` executed in CI.                    |
| **2. Build Flutter Web**      | `flutter build web --release --base-href "/<repo_name>/"`.                                   |
| **3. Copy Content**           | Copy `assets/contents/` ‚Üí `build/web/contents/` for raw Markdown hosting.                    |
| **4. Deploy**                 | Push `build/web` ‚Üí `gh-pages` branch (GitHub Pages).                                         |
| **5. Multi-Platform Build**   | On tag push (`v*.*.*`): `flutter build apk`, `flutter build windows`, `flutter build linux`. |
| **6. Release**                | Upload generated binaries to GitHub Releases.                                                |

---

## üß∞ Dependencies (active & maintained)

| Category | Package                      | Purpose                                       |
| -------- | ---------------------------- | --------------------------------------------- |
| Markdown | `flutter_markdown_plus`      | Markdown rendering (non-deprecated).          |
| Routing  | `go_router`                  | URL routing and deep linking.                 |
| State    | `flutter_riverpod`           | State management.                             |
| Parsing  | `yaml`, `front_matter`       | YAML & front-matter parsing.                  |
| Crypto   | `cryptography`, `argon2`     | AES-GCM & Argon2id for encryption/decryption. |
| IO/Net   | `http`, `path`, `collection` | File fetch, utilities.                        |

---

## üß© Content Type Conventions

| Type       | Folder       | Default Route     | Render Template          |
| ---------- | ------------ | ----------------- | ------------------------ |
| `page`     | `/pages/`    | `/slug`           | Generic Page viewer.     |
| `project`  | `/projects/` | `/projects/:slug` | Project detail template. |
| `post`     | `/blog/`     | `/blog/:slug`     | Blog post template.      |
| `lab`      | `/labs/`     | `/labs/:slug`     | Experiment viewer.       |
| `resource` | `/library/`  | `/library/:slug`  | Resource/article viewer. |

---

## üîß Developer Utilities

| Command                                    | Purpose                                |
| ------------------------------------------ | -------------------------------------- |
| `flutter run -d chrome`                    | Local web dev preview.                 |
| `dart run lib/tools/encrypt_markdown.dart` | Encrypt private Markdown.              |
| `dart run lib/tools/build_manifest.dart`   | Rebuild manifest after adding content. |
| `dart run lib/tools/gen_sitemap.dart`      | Update sitemap.xml.                    |
| `dart run lib/tools/gen_rss.dart`          | Update RSS feed.                       |
| `flutter build web`                        | Manual web build.                      |
| `flutter build apk / windows / linux`      | Platform builds.                       |

---

## üß± Security & Privacy Design

- **No passphrases stored**; keys exist only in memory.
- **Front-matter** never includes secrets.
- **Private pages** use Argon2id + AES-GCM encryption.
- **GitHub Pages** hosts ciphertext only; safe at rest.
- **Users** enter passphrase to decrypt in browser or app.
- **All encryption/decryption runs client-side** in Dart.

---

## üßÆ Data Flow Summary

```text
Markdown (.md)
   ‚Üì (YAML parsed)
FrontMatter + Body
   ‚Üì (if private ‚Üí encrypt_markdown.dart)
Encrypted or Plain Body
   ‚Üì
Manifest Generator ‚Üí manifest.json
   ‚Üì
App Startup ‚Üí loads manifest
   ‚Üì
User navigates ‚Üí loads .md
   ‚Üì
If :::cipher ‚Üí prompt ‚Üí derive key ‚Üí decrypt ‚Üí render
Else ‚Üí render directly
```

---

## üåç Multi-Platform Output

| Platform    | Output                    | Distribution                 |
| ----------- | ------------------------- | ---------------------------- |
| **Web**     | `build/web/` ‚Üí `gh-pages` | GitHub Pages static hosting. |
| **Android** | `.apk` / `.aab`           | GitHub Releases.             |
| **Windows** | `.zip` / `.exe`           | GitHub Releases.             |
| **Linux**   | `.tar.gz` / `.AppImage`   | GitHub Releases.             |

---

## üß† Recommended Workflow

1. Create or update Markdown file in `assets/contents/`.
2. If `visibility: private`, run `encrypt_markdown.dart`.
3. Run `build_manifest.dart` (or let CI do it).
4. Commit and push ‚Üí CI deploys automatically.
5. Site auto-updates ‚Äî new item appears instantly.

No code edits required for new content.

---

## ‚úÖ Summary

This architecture gives you:

- **Dynamic discovery** ‚Äî just add `.md`, auto-listed.
- **Offline-capable** ‚Äî Flutter Web PWA.
- **Cross-platform binaries** ‚Äî one codebase.
- **Client-side encryption** ‚Äî no server secrets.
- **Zero cost hosting** ‚Äî GitHub Pages + Releases.
- **Easily extendable** ‚Äî add new content types via front-matter.
