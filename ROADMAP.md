# Top-level tree (everything you need)

```
/
├─ .github/
│  ├─ ISSUE_TEMPLATE/
│  │  ├─ bug_report.yml
│  │  └─ feature_request.yml
│  └─ workflows/
│     ├─ deploy_pages.yml          # CI: build Flutter web -> gh-pages
│     └─ releases.yml              # CI: tag builds (Android/Windows/Linux) -> Releases
│
├─ .vscode/
│  ├─ settings.json                # formatting, trailing spaces, endOfLine
│  └─ extensions.json              # recommended Flutter/Dart extensions
│
├─ android/                        # (generated by Flutter; leave as-is)
├─ ios/                            # (generated)
├─ linux/                          # (generated)
├─ macos/                          # (generated)
├─ windows/                        # (generated)
├─ web/
│  ├─ icons/                       # PWA icons
│  ├─ index.html                   # Flutter web entry
│  ├─ robots.txt                   # copied/overwritten by CI tools if needed
│  ├─ favicon.png
│  └─ manifest.json                # PWA config (Flutter)
│
├─ assets/
│  └─ contents/                    # ALL content (public + private) in one tree
│     ├─ pages/
│     │  ├─ home.md
│     │  └─ about.md
│     ├─ projects/
│     │  ├─ judicial-v2t.md        # example (private; encrypted body)
│     │  └─ wood-identification.md  # example (public)
│     ├─ blog/
│     │  ├─ decision-log-001.md
│     │  └─ system-note-private.md  # example (private)
│     ├─ labs/
│     ├─ library/
│     ├─ meta/
│     ├─ foundation/
│     ├─ _media/                   # images used by markdown
│     │  └─ judicial-thumb.png
│     └─ manifest.json             # generated by lib/tools/build_manifest.dart
│
├─ lib/
│  ├─ app/                         # app bootstrap & top-level composition
│  │  ├─ main.dart                 # entrypoint
│  │  ├─ router.dart               # go_router routes (hash or baseHref aware)
│  │  ├─ theme.dart                # color tokens, typography, spacing
│  │  ├─ di.dart                   # simple service locators/providers
│  │  └─ config.dart               # constants (site title, base href, etc.)
│  │
│  ├─ core/                        # framework-agnostic building blocks
│  │  ├─ models.dart               # FrontMatter, ContentNode, CipherBlock, etc.
│  │  ├─ front_matter.dart         # parse '---' YAML front-matter -> Map<String,dynamic>
│  │  ├─ markdown_loader.dart      # load raw .md (asset/http), split fm/body
│  │  ├─ cipher_block.dart         # parse/write :::cipher fences
│  │  ├─ crypto.dart               # Argon2id KDF + AES-256-GCM encrypt/decrypt
│  │  ├─ manifest.dart             # read/filter/search manifest.json
│  │  ├─ search_index.dart         # in-memory search (public + unlocked private)
│  │  ├─ seo.dart                  # web: update <title>, meta description, OG tags
│  │  ├─ a11y.dart                 # helpers for focus, semantics, reduced motion
│  │  └─ utils.dart                # misc (slugify, date, path helpers)
│  │
│  ├─ features/                    # vertical features map to your sitemap
│  │  ├─ shell/
│  │  │  ├─ app_shell.dart         # top app scaffold (nav/header/footer)
│  │  │  ├─ nav.dart               # top & footer nav widgets
│  │  │  └─ not_found.dart         # 404
│  │  ├─ home/
│  │  │  └─ home_page.dart
│  │  ├─ about/
│  │  │  └─ about_page.dart
│  │  ├─ projects/
│  │  │  ├─ projects_index_page.dart
│  │  │  ├─ project_detail_page.dart
│  │  │  └─ project_badges.dart
│  │  ├─ blog/
│  │  │  ├─ blog_index_page.dart
│  │  │  ├─ blog_series_page.dart
│  │  │  └─ blog_post_page.dart
│  │  ├─ services/
│  │  │  └─ services_page.dart
│  │  ├─ labs/
│  │  │  └─ labs_page.dart
│  │  ├─ library/
│  │  │  └─ library_page.dart
│  │  ├─ contact/
│  │  │  └─ contact_page.dart
│  │  ├─ resume/
│  │  │  └─ resume_page.dart
│  │  ├─ newsletter/
│  │  │  ├─ subscribe_page.dart
│  │  │  └─ archive_page.dart
│  │  ├─ meta/
│  │  │  ├─ meta_index_page.dart
│  │  │  ├─ personality_page.dart
│  │  │  ├─ tarot_page.dart
│  │  │  ├─ numerology_page.dart
│  │  │  ├─ bazi_page.dart
│  │  │  ├─ tcm_page.dart
│  │  │  ├─ philosophy_of_work_page.dart
│  │  │  ├─ systems_page.dart
│  │  │  └─ justice_manifesto_page.dart
│  │  ├─ inner/                    # login/private UX
│  │  │  ├─ inner_dashboard_page.dart
│  │  │  ├─ inner_case_studies_page.dart
│  │  │  ├─ inner_research_page.dart
│  │  │  ├─ inner_resources_page.dart
│  │  │  ├─ inner_journals_page.dart
│  │  │  ├─ inner_metaphysics_page.dart
│  │  │  ├─ inner_clients_page.dart
│  │  │  ├─ lock_gate.dart         # passphrase dialog + validation + key lifecycle
│  │  │  └─ unlock_controller.dart # in-memory key, lock/unlock state
│  │  ├─ timeline/
│  │  │  └─ timeline_page.dart
│  │  └─ foundation/
│  │     ├─ search_page.dart
│  │     ├─ sitemap_page.dart      # optional if you want a human-readable page
│  │     ├─ privacy_page.dart
│  │     ├─ terms_page.dart
│  │     ├─ cookies_page.dart
│  │     ├─ accessibility_page.dart
│  │     └─ changelog_page.dart
│  │
│  ├─ widgets/                     # shared UI components
│  │  ├─ md_view.dart              # wraps flutter_markdown_plus; image/code styling
│  │  ├─ md_image.dart             # resolves /assets/contents/_media/*
│  │  ├─ callout.dart              # info/warn/ethics callouts
│  │  ├─ toc.dart                  # table-of-contents generator from headings
│  │  ├─ chips.dart                # tag/series chips
│  │  ├─ search_box.dart
│  │  ├─ section_header.dart
│  │  ├─ metrics_strip.dart
│  │  └─ lock_banner.dart          # shows "Private mode active • Lock again"
│  │
│  └─ tools/                       # CLI tools (run: dart run lib/tools/<file>.dart)
│     ├─ encrypt_markdown.dart     # if visibility: private -> encrypt body -> :::cipher
│     ├─ build_manifest.dart       # scan /assets/contents -> manifest.json
│     ├─ gen_sitemap.dart          # sitemap.xml for public items
│     └─ gen_rss.dart              # rss.xml for blog public posts
│
├─ pubspec.yaml
├─ analysis_options.yaml           # lints (pedantic-like, a11y-friendly)
├─ README.md                       # how to run, write, encrypt, deploy
├─ LICENSE                         # e.g., MIT (for your site code)
├─ .gitignore
├─ .gitattributes                  # text=auto, linguist overrides
└─ .editorconfig                   # whitespace, utf-8, lf
```

> **Why no `/test`?** You said _all Dart must be in `lib/`_. If you still want tests, add a custom harness under `lib/tools/test_runner.dart` that calls assertions for core functions (front-matter parsing, cipher round-trip), and run it via `dart run lib/tools/test_runner.dart`.

---

## Minimal seed files (copy/paste)

### `assets/contents/pages/home.md` (public)

```md
---
title: "Home"
slug: "/"
type: "page"
realm: "outer"
visibility: "public"
summary: "Applied AI Engineer — Calm, privacy-first systems."
---

Welcome. This site renders from Markdown. Projects and posts are below.
```

### `assets/contents/projects/judicial-v2t.md` (private — before encrypt)

```md
---
title: "Judicial V2T Backend"
slug: "judicial-v2t"
type: "project"
realm: "outer"
visibility: "private"
summary: "On-prem ASR with Whisper + FastAPI + Docker; rollback-ready."
tags: ["whisper", "fastapi", "docker", "on-prem"]
thumbnail: "/assets/contents/_media/judicial-thumb.png"
---

# Overview

(plaintext body here will be replaced by :::cipher block by the CLI)
```

After running the encryptor, the body becomes:

```md
---
title: "Judicial V2T Backend"
slug: "judicial-v2t"
type: "project"
realm: "outer"
visibility: "private"
summary: "On-prem ASR with Whisper + FastAPI + Docker; rollback-ready."
tags: ["whisper", "fastapi", "docker", "on-prem"]
thumbnail: "/assets/contents/_media/judicial-thumb.png"
---

:::cipher
algo: aes-256-gcm
kdf: argon2id
salt: <base64>
nonce: <base64>
body: |
<base64-ciphertext>
:::
```

---

# What each key area does

### `.github/workflows/deploy_pages.yml`

- Checks out repo
- Sets up Flutter (stable)
- `flutter pub get`
- `dart run lib/tools/build_manifest.dart`
- `dart run lib/tools/gen_sitemap.dart`
- `dart run lib/tools/gen_rss.dart`
- `flutter build web --release --base-href "/<repo_name>/"`
- Pushes `build/web/` to `gh-pages` branch

### `.github/workflows/releases.yml`

- Trigger: push tag `v*.*.*`
- Matrix build:

  - Android: `flutter build apk`
  - Windows: `flutter build windows`
  - Linux: `flutter build linux`

- Upload artifacts to **GitHub Releases**

### `lib/tools/encrypt_markdown.dart`

- Walks `assets/contents/**.md`
- For each `visibility: private` with plaintext body:

  - Prompt for passphrase (stdin)
  - Derive key via **Argon2id** (strong params)
  - Encrypt body **AES-256-GCM** (random nonce)
  - Replace body with `:::cipher` block

- Safe to run repeatedly (idempotent check)

### `lib/core/markdown_loader.dart`

- Loads the `.md` (via `rootBundle` or `http` from GH Pages)
- Splits front-matter and body
- If body contains `:::cipher` block, emits a `CipherBlock` instead of plaintext

### `lib/features/inner/lock_gate.dart`

- If page is private:

  - ask for passphrase → derive key → try to decrypt
  - on success, render decrypted body via `flutter_markdown_plus`
  - store derived key in memory only; **Lock again** clears it

### `lib/widgets/md_view.dart`

- Wraps `flutter_markdown_plus`
- Handles images relative to `/assets/contents/_media`
- Renders headings with anchors (for TOC)
- Custom builders for fenced callouts

---

# Add-on files (recommended)

- **`analysis_options.yaml`**
  Enable useful lints (null safety, avoid dynamic, prefer const, etc.)

- **`.editorconfig`**
  Keep whitespace and line endings consistent across platforms.

- **`README.md`**
  Include:

  - How to run web/desktop/mobile
  - How to write Markdown
  - How to encrypt private content
  - How CI/CD deploys
  - Passphrase rotation steps

- **`LICENSE`**
  MIT or your choice (code only). Your content can be “All rights reserved” if you prefer — add notes in `README`.

- **`CODE_OF_CONDUCT.md` / `CONTRIBUTING.md`** (optional)
  If you open to contributions later.

---
